
query NavQuery($rev: String!) {
  refs { name }
  workspaces: rev(at: $rev, filter: "::**/workspace.josh") {
    paths: files {
      dir(relative: "..") {
        path 
        rev(filter: ":workspace={path}") { 
          warnings { message }
        }
      }
    }
  }
}

query PathQuery($rev: String!, $filter: String!, $path: String!) {
  rev(at:$rev, filter:$filter) {
    warnings {
      message
    }
    file(path:$path) {
      text
      meta(topic: "findings") {
        data {
          position: string(at: "/location")
          text: string(at: "/message")
        }
      }
    }
    dirs(at:$path,depth: 1) { path, meta(topic:"findings") { count } }
    files(at:$path,depth: 1) { path, meta(topic:"findings") { count } }
  }
}
